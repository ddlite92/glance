server:
  host: 0.0.0.0
  port: 8081

pages:
  - name: Home
    # Optionally, if you only have a single page you can hide the desktop navigation for a cleaner look
    # hide-desktop-navigation: true
    columns:
      - size: small
        widgets:
            - type: split-column
              max-columns: 1
              widgets:
                - type: repository
                  title: OpenCue
                  token: ${GITHUB_TOKEN}
                  repository: AcademySoftwareFoundation/OpenCue
                  commits-limit: 3
                  allow-insecure: true
                - type: repository
                  title: Open Shading Language
                  token: ${GITHUB_TOKEN}
                  repository: AcademySoftwareFoundation/OpenShadingLanguage
                  commits-limit: 3
                  allow-insecure: true
                - type: repository
                  title: OpenAI Python
                  token: ${GITHUB_TOKEN}
                  repository: openai/openai-python
                  commits-limit: 3
                  allow-insecure: true

      - size: full
        widgets:
          - type: custom-api
            title: Cats as a Service
            url: https://cataas.com/api/cats?limit=12
            allow-insecure: true
            cache: 1h
            template: |
              <div class="cat-photo-grid">
                {{ range .JSON.Array "" }}
                  <div class="cat-photo-item">
                    <img src="https://cataas.com/cat/{{ .String "id" }}" alt="cat" style="width:100%;border-radius:8px;box-shadow:0 2px 8px #0002;" />
                  </div>
                {{ end }}
              </div>

      - size: small
        widgets:
          - type: calendar
            first-day-of-week: monday
          
          - type: custom-api
            title: Trending GitHub Repos
            cache: 24h
            allow-insecure: true
            url: 'https://api.ossinsight.io/v1/trends/repos/?period=past_24_hours&language=All'
            template: |
              <ul class="list list-gap-10 collapsible-container" data-collapse-after="5">
                {{ range .JSON.Array "data.rows"}}
                  <li>
                    <a class="color-primary-if-not-visited" href="https://github.com/{{ .String "repo_name" }}">{{ .String "repo_name" }}</a>
                    <ul class="list-horizontal-text">
                      <li class="color-highlight">{{.String "primary_language"}}</li>
                      <li style="display: flex; align-items: center;gap: 4px;">{{ .Int "stars" }}
                        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true" focusable="false"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                      </li>
                      <li style="display: flex; align-items: center;gap: 4px;">{{ .Int "forks" }}
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="18" r="2" /><circle cx="7" cy="6" r="2" /><circle cx="17" cy="6" r="2" /><path d="M7 8v2a2 2 0 0 0 2 2h6a2 2 0 0 0 2 -2v-2" /><path d="M12 12l0 4" /></svg>
                      </li>
                      <li style="display: flex; align-items: center;gap: 4px;">{{ .Int "pull_requests" }}
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="18" r="3"></circle><path d="M13 6h3a2 2 0 0 1 2 2v7"></path><line x1="6" y1="9" x2="6" y2="21"></line></svg>
                      </li>
                    </ul>
                    <ul class="list collapsible-container">
                      <li style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" class="color-subdue">Contributors: {{ .String "contributor_logins"}}</li>
                      <li>{{ .String "description" }}</li>
                    </ul>
                  </li>
                {{ end }}
              </ul>
              
  
  - name: Developer
    columns:
      - size: full
        widgets:
          - type: split-column
            max-columns: 4
            widgets:
              - type: repository
                title: "Monsta Pipeline Issues"
                token: ${GITHUB_TOKEN}
                repository: MonstaStudios/monsta_pipeline_issues
                pull-requests-limit: 5
                issues-limit: 5
                commits-limit: 3
                allow-insecure: true

              - type: repository
                title: "Monsta Studio Pipeline"
                token: ${GITHUB_TOKEN}
                repository: MonstaStudios/monsta-studio-pipeline
                pull-requests-limit: 5
                issues-limit: 3
                commits-limit: 3
                allow-insecure: true

              - type: repository
                title: "Blender Submit Tool"
                token: ${GITHUB_TOKEN}
                repository: MonstaStudios/cgru_tools
                pull-requests-limit: 5
                issues-limit: 3
                commits-limit: 3
                allow-insecure: true

              - type: repository
                title: "Blender"
                token: ${GITHUB_TOKEN}
                repository: MonstaStudios/blender
                pull-requests-limit: 5
                issues-limit: 3
                commits-limit: 3
                allow-insecure: true

      - size: small
        widgets:
          - type: monitor
            style: vertical-list
            cache: 1m
            title: Services
            sites:
              - title: Kitsu
                url: https://pro.monsta.com/
                allow-insecure: true
              - title: Monsta Review
                url: https://rev.monsta.com/
                allow-insecure: true
              - title: Issue Form
                url: https://monsta-pipeline-issues.vercel.app/
                allow-insecure: true
              - title: Monsta Studio Github
                url: https://github.com/MonstaStudios
                allow-insecure: true
              - title: Monsta Sync
                url: http://192.168.90.103:8384/
              - title: Afanays Web UI
                url: http://192.168.90.103:51000/
              - title: Afanasy API
                url: http://192.168.90.104:5000/afanasy/jobs
                icon: si:json
              - title: Afanasy Machines
                url: http://192.168.90.104:5000/afanasy/renders

  - name: Render Job
    columns:
      - size: full
        widgets:
          - type: custom-api
            title: Render Jobs (- refresh to update -)
            url: http://192.168.90.104:5000/afanasy/jobs
            cache: 0s
            refresh-interval: 10s
            template: |
              <!--
                Note: For true real-time, ensure the API and Glance backend are not caching responses.
                This widget refreshes every 10s, but backend/API cache may delay updates.
              -->
              <style>
                .job-dashboard-table {
                  width: 100%;
                  border-collapse: collapse;
                  margin-top: 1em;
                  background: #181a20;
                  border-radius: 8px;
                  overflow: hidden;
                  font-size: 1em;
                }
                .job-dashboard-table th, .job-dashboard-table td {
                  padding: 0.7em 1em;
                  text-align: left;
                }
                .job-dashboard-table th {
                  background: #23242a;
                  color: #ffe082;
                  font-weight: 700;
                  letter-spacing: 1px;
                }
                .job-dashboard-table tr:nth-child(even) {
                  background: #23242a;
                }
                .job-dashboard-table tr:nth-child(odd) {
                  background: #202124;
                }
                .job-progress-bar {
                  width: 120px;
                  height: 12px;
                  background: #333;
                  border-radius: 6px;
                  overflow: hidden;
                  display: inline-block;
                  margin-right: 0.5em;
                  vertical-align: middle;
                }
                .job-progress-fill {
                  height: 100%;
                  background: linear-gradient(90deg, #ffe082, #ffd54f 80%);
                  border-radius: 6px 0 0 6px;
                  transition: width 0.5s;
                }
                .job-user {
                  color: #90caf9;
                  font-weight: 600;
                  font-size: 0.97em;
                  letter-spacing: 0.5px;
                }
                .job-status {
                  font-weight: 600;
                  padding: 0.2em 0.7em;
                  border-radius: 5px;
                  color: #fff;
                  display: inline-block;
                  font-size: 0.95em;
                }
                .job-status.DON { background: #4caf50; }
                .job-status.ERR { background: #e57373; }
                .job-status.SUS { background: #ffb300; }
                .job-status.RDY { background: #64b5f6; }
                .job-status.OFF { background: #757575; }
                .job-status.UNKNOWN { background: #b0bec5; }
              </style>
              <h2 style="margin-bottom:0.5em;">Render Jobs - Realtime Tracking</h2>
              <div class="filter-bar">
                <form method="get">
                  <input class="filter-input" type="text" name="user" value="{{ .Options.StringOr "user" "" }}" placeholder="Filter by user (e.g. mon176)" />
                  <button type="submit">Filter</button>
                </form>
              </div>
              <table class="job-dashboard-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>User</th>
                    <th>Status</th>
                    <th>Progress</th>
                  </tr>
                </thead>
                <tbody>
                  {{ $jobs := (filterNot "user_name" "afadmin" (sort (.JSON.Array "jobs") "user_name")) }}
                  {{ $user := .Options.StringOr "user" "" }}
                  {{ if $user }}
                    {{ $jobs := filter "user_name" $user $jobs }}
                  {{ end }}
                  {{ range $jobs }}
                  <tr>
                    <td>{{ .Int "id" }}</td>
                    <td>{{ .String "name" }}</td>
                    <td><span class="job-user">{{ .String "user_name" }}</span></td>
                    <td>
                      {{ $status := (or (.String "state") (.String "status") "UNKNOWN") }}
                      <span class="job-status {{ $status }}">{{ $status }}</span>
                    </td>
                    <td>
                      <div class="job-progress-bar">
                        <div class="job-progress-fill" style="width: {{ .Int "progress_percentage" }}%;"></div>
                      </div>
                      <span>{{ .Int "progress_percentage" }}%</span>
                    </td>
                  </tr>
                  {{ end }}
                </tbody>
              </table>

  - name: Render Machines
    columns:
      - size: full
        widgets:
          - type: custom-api
            title: Render Machines (LIVE)
            url: http://192.168.90.104:5000/afanasy/renders
            cache: 0s
            refresh-interval: 10s
            allow-insecure: true
            template: |
             <style>
                .machine-cluster { margin-bottom: 2em; }
                .machine-title { font-size: 1.2em; font-weight: bold; margin-bottom: 0.5em; }
                .machine-list { list-style: none; padding: 0; }
                .machine-item { padding: 0.5em 1em; border-bottom: 1px solid #23242a; }
                .offline { color: #e57373; }
                .online { color: #4caf50; }
                .nimby { color: #ffb300; }
                .running { color: #64b5f6; }
                .machine-meta { font-size: 0.95em; color: #aaa; }
              </style>
              <h2>Render Machines - Clustered by State</h2>
              {{ $machines := .JSON.Array "" }}
              {{ $offline := filter "state" "OFF NBY" $machines }}
              {{ $online := filter "state" "ONL" $machines }}
              {{ $nimby := filter "state" "ONL NBY" $machines }}
              {{ $running := filter "state" "ONL RUN" $machines }}

              <div class="machine-cluster">
                <div class="machine-title offline">Offline (OFF NBY)</div>
                <ul class="machine-list">
                  {{ range $offline }}
                    <li class="machine-item offline">
                      <b>{{ .String "name" }}</b>
                      <span class="machine-meta">[ID: {{ .Int "id" }}, Host: {{ .String "host_name" }}]</span>
                      <span>State: {{ .String "state" }}</span>
                    </li>
                  {{ end }}
                </ul>
              </div>
              <div class="machine-cluster">
                <div class="machine-title online">Online (ONL)</div>
                <ul class="machine-list">
                  {{ range $online }}
                    <li class="machine-item online">
                      <b>{{ .String "name" }}</b>
                      <span class="machine-meta">[ID: {{ .Int "id" }}, Host: {{ .String "host_name" }}]</span>
                      <span>State: {{ .String "state" }}</span>
                    </li>
                  {{ end }}
                </ul>
              </div>
              <div class="machine-cluster">
                <div class="machine-title nimby">Online Nimby (ONL NBY)</div>
                <ul class="machine-list">
                  {{ range $nimby }}
                    <li class="machine-item nimby">
                      <b>{{ .String "name" }}</b>
                      <span class="machine-meta">[ID: {{ .Int "id" }}, Host: {{ .String "host_name" }}]</span>
                      <span>State: {{ .String "state" }}</span>
                    </li>
                  {{ end }}
                </ul>
              </div>
              <div class="machine-cluster">
                <div class="machine-title running">Running (ONL RUN)</div>
                <ul class="machine-list">
                  {{ range $running }}
                    <li class="machine-item running">
                      <b>{{ .String "name" }}</b>
                      <span class="machine-meta">[ID: {{ .Int "id" }}, Host: {{ .String "host_name" }}]</span>
                      <span>State: {{ .String "state" }}</span>
                    </li>
                  {{ end }}
                </ul>
              </div>
  

  # Add more pages here:
  # - name: Your page name
  #   columns:
  #     - size: small
  #       widgets:
  #         # Add widgets here

  #     - size: full
  #       widgets:
  #         # Add widgets here

  #     - size: small
  #       widgets:
  #         # Add widgets here