server:
  host: 0.0.0.0
  port: 8081

pages:
  - name: Home
    # Optionally, if you only have a single page you can hide the desktop navigation for a cleaner look
    # hide-desktop-navigation: true
    columns:
      - size: small
        widgets:
            - type: split-column
              max-columns: 1
              widgets:
                - type: repository
                  title: OpenCue
                  token: ${GITHUB_TOKEN}
                  repository: AcademySoftwareFoundation/OpenCue
                  commits-limit: 3
                  pull-requests-limit: 0
                  issues-limit: 0
                  allow-insecure: true
                - type: repository
                  title: Open Shading Language
                  token: ${GITHUB_TOKEN}
                  repository: AcademySoftwareFoundation/OpenShadingLanguage
                  commits-limit: 3
                  pull-requests-limit: 0
                  issues-limit: 0
                  allow-insecure: true
                - type: repository
                  title: OpenAI Python
                  token: ${GITHUB_TOKEN}
                  repository: openai/openai-python
                  commits-limit: 3
                  pull-requests-limit: 0
                  issues-limit: 0
                  allow-insecure: true

      - size: full
        widgets:
          - type: custom-api
            title: Cats as a Service
            url: https://cataas.com/api/cats?limit=12
            allow-insecure: true
            cache: 1h
            template: |
              <style>
                .cat-photo-grid { display: flex; flex-wrap: wrap; gap: 12px; }
                .cat-photo-item { width: 160px; }
                .cat-photo-item img { width: 100%; max-width: 1150px; height: auto; border-radius: 8px; box-shadow: 0 2px 8px #0002; }
              </style>
              <div class="cat-photo-grid">
                {{ range .JSON.Array "" }}
                  <div class="cat-photo-item">
                    <img src="https://cataas.com/cat/{{ .String "id" }}" alt="cat" />
                  </div>
                {{ end }}
              </div>

      - size: small
        widgets:
          - type: calendar
            first-day-of-week: monday
          
          - type: custom-api
            title: Trending GitHub Repos
            cache: 24h
            allow-insecure: true
            url: 'https://api.ossinsight.io/v1/trends/repos/?period=past_24_hours&language=All'
            template: |
              <ul class="list list-gap-10 collapsible-container" data-collapse-after="5">
                {{ range .JSON.Array "data.rows"}}
                  <li>
                    <a class="color-primary-if-not-visited" href="https://github.com/{{ .String "repo_name" }}">{{ .String "repo_name" }}</a>
                    <ul class="list-horizontal-text">
                      <li class="color-highlight">{{.String "primary_language"}}</li>
                      <li style="display: flex; align-items: center;gap: 4px;">{{ .Int "stars" }}
                        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true" focusable="false"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                      </li>
                      <li style="display: flex; align-items: center;gap: 4px;">{{ .Int "forks" }}
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="18" r="2" /><circle cx="7" cy="6" r="2" /><circle cx="17" cy="6" r="2" /><path d="M7 8v2a2 2 0 0 0 2 2h6a2 2 0 0 0 2 -2v-2" /><path d="M12 12l0 4" /></svg>
                      </li>
                      <li style="display: flex; align-items: center;gap: 4px;">{{ .Int "pull_requests" }}
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="18" r="3"></circle><path d="M13 6h3a2 2 0 0 1 2 2v7"></path><line x1="6" y1="9" x2="6" y2="21"></line></svg>
                      </li>
                    </ul>
                    <ul class="list collapsible-container">
                      <li style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" class="color-subdue">Contributors: {{ .String "contributor_logins"}}</li>
                      <li>{{ .String "description" }}</li>
                    </ul>
                  </li>
                {{ end }}
              </ul>
              
  
  - name: Developer
    columns:
      - size: full
        widgets:
          - type: split-column
            max-columns: 4
            widgets:
              - type: repository
                title: "Monsta Pipeline Issues"
                token: ${GITHUB_TOKEN}
                repository: MonstaStudios/monsta_pipeline_issues
                pull-requests-limit: 5
                issues-limit: 5
                commits-limit: 3
                allow-insecure: true

              - type: repository
                title: "Monsta Studio Pipeline"
                token: ${GITHUB_TOKEN}
                repository: MonstaStudios/monsta-studio-pipeline
                pull-requests-limit: 5
                issues-limit: 3
                commits-limit: 3
                allow-insecure: true

              - type: repository
                title: "Blender Submit Tool"
                token: ${GITHUB_TOKEN}
                repository: MonstaStudios/cgru_tools
                pull-requests-limit: 5
                issues-limit: 3
                commits-limit: 3
                allow-insecure: true

              - type: repository
                title: "Blender"
                token: ${GITHUB_TOKEN}
                repository: MonstaStudios/blender
                pull-requests-limit: 5
                issues-limit: 3
                commits-limit: 3
                allow-insecure: true

      - size: small
        widgets:
          - type: monitor
            style: vertical-list
            cache: 1m
            title: Services
            sites:
              - title: Kitsu
                url: https://pro.monsta.com/
                allow-insecure: true
              - title: Monsta Review
                url: https://rev.monsta.com/
                allow-insecure: true
              - title: Issue Form
                url: https://monsta-pipeline-issues.vercel.app/
                allow-insecure: true
              - title: Monsta Studio Github
                url: https://github.com/MonstaStudios
                allow-insecure: true
              - title: Monsta Sync
                url: http://192.168.90.103:8384/
              - title: Afanays Web UI
                url: http://192.168.90.103:51000/
              - title: Afanasy API
                url: http://192.168.90.104:5000/afanasy/jobs
                icon: si:json
              - title: Afanasy Machines
                url: http://192.168.90.104:5000/afanasy/renders

  - name: Render Job
    columns:
      - size: full
        widgets:
          - type: custom-api
            title: Render Jobs (- refresh to update -)
            url: http://192.168.90.104:5000/afanasy/jobs
            cache: 0s
            refresh-interval: 10s
            template: |
              <!--
                Note: For true real-time, ensure the API and Glance backend are not caching responses.
                This widget refreshes every 10s, but backend/API cache may delay updates.
              -->
              <style>
                .job-dashboard-table {
                  width: 100%;
                  border-collapse: collapse;
                  margin-top: 1em;
                  background: #181a20;
                  border-radius: 8px;
                  overflow: hidden;
                  font-size: 1em;
                }
                .job-dashboard-table th, .job-dashboard-table td {
                  padding: 0.7em 1em;
                  text-align: left;
                }
                .job-dashboard-table th {
                  background: #23242a;
                  color: #ffe082;
                  font-weight: 700;
                  letter-spacing: 1px;
                }
                .job-dashboard-table tr:nth-child(even) {
                  background: #23242a;
                }
                .job-dashboard-table tr:nth-child(odd) {
                  background: #202124;
                }
                .job-progress-bar {
                  width: 120px;
                  height: 12px;
                  background: #333;
                  border-radius: 6px;
                  overflow: hidden;
                  display: inline-block;
                  margin-right: 0.5em;
                  vertical-align: middle;
                }
                .job-progress-fill {
                  height: 100%;
                  background: linear-gradient(90deg, #ffe082, #ffd54f 80%);
                  border-radius: 6px 0 0 6px;
                  transition: width 0.5s;
                }
                .job-user {
                  color: #90caf9;
                  font-weight: 600;
                  font-size: 0.97em;
                  letter-spacing: 0.5px;
                }
                .job-status {
                  font-weight: 600;
                  padding: 0.2em 0.7em;
                  border-radius: 5px;
                  color: #fff;
                  display: inline-block;
                  font-size: 0.95em;
                }
                .job-status.DON { background: #4caf50; }
                .job-status.ERR { background: #e57373; }
                .job-status.SUS { background: #ffb300; }
                .job-status.RDY { background: #64b5f6; }
                .job-status.OFF { background: #757575; }
                .job-status.UNKNOWN { background: #b0bec5; }
              </style>
              <h2 style="margin-bottom:0.5em;">Render Jobs Tracking</h2>
              <!-- Filter feature removed -->
              <table class="job-dashboard-table" id="jobTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>User</th>
                    <th>Status</th>
                    <th>Progress</th>
                  </tr>
                </thead>
                <tbody>
                  {{ $jobs := (filterNot "user_name" "afadmin" (sort (.JSON.Array "jobs") "user_name")) }}
                  {{ range $jobs }}
                  <tr>
                    <td>{{ .Int "id" }}</td>
                    <td>{{ .String "name" }}</td>
                    <td><span class="job-user">{{ .String "user_name" }}</span></td>
                    <td>
                      {{ $status := (or (.String "state") (.String "status") "UNKNOWN") }}
                      <span class="job-status {{ $status }}">{{ $status }}</span>
                    </td>
                    <td>
                      <div class="job-progress-bar">
                        <div class="job-progress-fill" style="width: {{ .Int "progress_percentage" }}%;"></div>
                      </div>
                      <span>{{ .Int "progress_percentage" }}%</span>
                    </td>
                  </tr>
                  {{ end }}
                </tbody>
              </table>
              <!-- JS filter removed -->

  - name: Render Machines
    columns:
      - size: full
        widgets:
          - type: custom-api
            title: Render Machines (- refresh to update -)
            url: http://192.168.90.104:5000/afanasy/renders
            cache: 0s
            refresh-interval: 10s
            allow-insecure: true
            template: |
             <style>
                .machine-clusters { display: flex; gap: 32px; }
                .machine-cluster { flex: 1; margin-bottom: 2em; }
                .machine-title { font-size: 1.2em; font-weight: bold; margin-bottom: 0.5em; }
                .machine-list { list-style: none; padding: 0; }
                .machine-item { padding: 0.5em 1em; border-bottom: 1px solid #23242a; }
                .offline { color: #e57373; }
                .online { color: #4caf50; }
                .nimby { color: #ffb300; }
                .running { color: #64b5f6; }
                .machine-meta { font-size: 0.95em; color: #aaa; }
              </style>
              <h2>Render Machines - Clustered by State</h2>
              <div class="machine-clusters">
                <div class="machine-cluster">
                  <div class="machine-title offline">Offline (OFF NBY)</div>
                  <ul class="machine-list">
                    {{ $offnby := (sort (filter "state" " OFF NBY" (.JSON.Array "renders")) "name") }}
                    {{ range $offnby }}
                      <li class="machine-item offline">
                        <b>{{ .String "name" }}</b>
                      </li>
                    {{ end }}
                  </ul>
                </div>
                <div class="machine-cluster">
                  <div class="machine-title online">Online (ONL)</div>
                  <ul class="machine-list">
                    {{ $onl := (sort (filter "state" " ONL" (.JSON.Array "renders")) "name") }}
                    {{ range $onl }}
                      <li class="machine-item online">
                        <b>{{ .String "name" }}</b>
                      </li>
                    {{ end }}
                  </ul>
                </div>
                <div class="machine-cluster">
                  <div class="machine-title nimby">Online Nimby (ONL NBY)</div>
                  <ul class="machine-list">
                    {{ $onlnby := (sort (filter "state" " ONL NBY" (.JSON.Array "renders")) "name") }}
                    {{ range $onlnby }}
                      <li class="machine-item nimby">
                        <b>{{ .String "name" }}</b>
                      </li>
                    {{ end }}
                  </ul>
                </div>
                <div class="machine-cluster">
                  <div class="machine-title running">Running (ONL RUN)</div>
                  <ul class="machine-list">
                    {{ $onlrun := (sort (filter "state" " ONL RUN" (.JSON.Array "renders")) "name") }}
                    {{ range $onlrun }}
                      <li class="machine-item running">
                        <b>{{ .String "name" }}</b>
                      </li>
                    {{ end }}
                  </ul>
                </div>
                <div class="machine-cluster">
                  <div class="machine-title" style="color:#ff9800;">Need To Check</div>
                  <ul class="machine-list">
                    {{ $all := (.JSON.Array "renders") }}
                    {{ $needcheck := (filterNot "state" " OFF NBY" (filterNot "state" " ONL" (filterNot "state" " ONL NBY" (filterNot "state" " ONL RUN" $all)))) }}
                    {{ range (sort $needcheck "name") }}
                      <li class="machine-item">
                        <b>{{ .String "name" }}</b>
                        <span style="color:#ff9800;">State: {{ .String "state" }}</span>
                      </li>
                    {{ end }}
                  </ul>
                </div>
              </div>
  
  - name: Machines
    columns:
      - size: full
        widgets:
          - type: custom-api
            title: Machine Activity Dashboard (- refresh to update -)
            url: http://192.168.90.104:5000/afanasy/renders/resources
            cache: 0s
            refresh-interval: 30s
            allow-insecure: true
            template: |
              <style>
                .machines-dashboard { font-family: system-ui, -apple-system, sans-serif; }
                .machines-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
                .summary-card { background: linear-gradient(135deg, #23242a 0%, #2d2e34 100%); padding: 16px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
                .summary-value { font-size: 2em; font-weight: 700; margin-bottom: 4px; }
                .summary-label { color: #aaa; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px; }
                .summary-card.online .summary-value { color: #4caf50; }
                .summary-card.offline .summary-value { color: #e57373; }
                .summary-card.busy .summary-value { color: #64b5f6; }
                .summary-card.available .summary-value { color: #ffb300; }
                
                .machines-table { width: 100%; border-collapse: collapse; margin-top: 1em; background: #181a20; border-radius: 8px; overflow: hidden; }
                .machines-table th, .machines-table td { padding: 12px 8px; text-align: left; }
                .machines-table td:first-child { width: 120px; padding-right: 4px; }
                .machines-table td:nth-child(2) { width: 70px; padding-left: 4px; }
                .machines-table td:nth-child(6) { width: 180px; padding-right: 4px; }
                .machines-table td:nth-child(7) { width: 70px; padding-left: 4px; }
                .machines-table th { background: #23242a; color: #ffe082; font-weight: 700; letter-spacing: 0.5px; position: sticky; top: 0; z-index: 10; font-size: 0.95em; }
                .machines-table tr:nth-child(even) { background: #202124; }
                .machines-table tr:nth-child(odd) { background: #23242a; }
                .machines-table tr:hover { background: #2a2b30; transition: background 0.2s; }
                
                .status-badge { padding: 3px 8px; border-radius: 5px; font-weight: 600; font-size: 0.8em; display: inline-block; white-space: nowrap; }
                .status-badge.online { background: #4caf50; color: #fff; }
                .status-badge.offline { background: #e57373; color: #fff; }
                .status-badge.busy { background: #64b5f6; color: #000; }
                .status-badge.nimby { background: #ffb300; color: #000; }
                
                .resource-bar { width: 100%; max-width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden; display: inline-block; margin-right: 6px; vertical-align: middle; }
                .resource-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
                .resource-fill.cpu { background: linear-gradient(90deg, #64b5f6, #42a5f5); }
                .resource-fill.mem { background: linear-gradient(90deg, #9575cd, #7e57c2); }
                .resource-fill.disk { background: linear-gradient(90deg, #ffb300, #ffa000); }
                .resource-fill.gpu { background: linear-gradient(90deg, #4caf50, #43a047); }
                .resource-fill.warning { background: linear-gradient(90deg, #ff9800, #f57c00) !important; }
                .resource-fill.danger { background: linear-gradient(90deg, #e57373, #e53935) !important; }
                
                .machine-name { font-weight: 600; color: #90caf9; font-size: 1.3em; }
                .resource-value { font-size: 0.95em; color: #ddd; vertical-align: middle; font-weight: 500; }
                .temp-value { color: #999; font-size: 0.85em; line-height: 1.4; }
                .hardware-info { color: #777; font-size: 0.8em; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
              </style>
              
              <div class="machines-dashboard">
                {{ $data := (index (.JSON.Array "") 0) }}
                
                <!-- Summary Cards -->
                <div class="machines-summary">
                  <div class="summary-card">
                    <div class="summary-value" style="color: #ffe082;">{{ $data.Int "summary.total" }}</div>
                    <div class="summary-label">Total Machines</div>
                  </div>
                  <div class="summary-card online">
                    <div class="summary-value">{{ $data.Int "summary.online" }}</div>
                    <div class="summary-label">Online</div>
                  </div>
                  <div class="summary-card offline">
                    <div class="summary-value">{{ $data.Int "summary.offline" }}</div>
                    <div class="summary-label">Offline</div>
                  </div>
                  <div class="summary-card busy">
                    <div class="summary-value">{{ $data.Int "summary.busy" }}</div>
                    <div class="summary-label">Busy</div>
                  </div>
                  <div class="summary-card available">
                    <div class="summary-value">{{ $data.Int "summary.available" }}</div>
                    <div class="summary-label">Available</div>
                  </div>
                  <div class="summary-card">
                    <div class="summary-value" style="color: #4caf50;">{{ $data.Int "summary.with_hardware" }}</div>
                    <div class="summary-label">With Hardware</div>
                  </div>
                </div>
                
                <!-- Machines Table -->
                <h3 style="margin: 20px 0 12px 0;">Machine Activity Monitor ({{ $data.Int "summary.total" }} machines) <span style="font-size: 0.7em; color: #666; font-weight: normal;">• Use Ctrl+F to search</span></h3>
                <table class="machines-table">
                  <thead>
                    <tr>
                      <th>Machine</th>
                      <th>Status</th>
                      <th>CPU</th>
                      <th>Memory</th>
                      <th>Disk</th>
                      <th>GPU</th>
                      <th>Network</th>
                      <th>Hardware</th>
                    </tr>
                  </thead>
                  <tbody>
                    {{ range (sort ($data.Array "renders") "name") }}
                    <tr>
                      <td>
                        <span class="machine-name">{{ .String "name" }}</span>
                      </td>
                      <td>
                        {{ if .Bool "online" }}
                          {{ if .Bool "busy" }}
                            <span class="status-badge busy">BUSY</span>
                          {{ else if .Bool "nimby" }}
                            <span class="status-badge nimby">NIMBY</span>
                          {{ else }}
                            <span class="status-badge online">ONLINE</span>
                          {{ end }}
                        {{ else }}
                          <span class="status-badge offline">OFFLINE</span>
                        {{ end }}
                      </td>
                      {{ if .Exists "host_resources" }}
                        <td>
                          {{ $cpuUsage := (.Int "host_resources.cpu_usage_percent") }}
                          <div class="resource-bar">
                            <div class="resource-fill cpu {{ if gt $cpuUsage 80 }}danger{{ else if gt $cpuUsage 60 }}warning{{ end }}" style="width: {{ $cpuUsage }}%;"></div>
                          </div>
                          <span class="resource-value">{{ $cpuUsage }}%</span>
                          <div class="temp-value">{{ .Int "host_resources.cpu_num" }} cores • {{ .Int "host_resources.cpu_temp" }}°C</div>
                        </td>
                        <td>
                          {{ $memUsage := (.Int "host_resources.mem_usage_percent") }}
                          <div class="resource-bar">
                            <div class="resource-fill mem {{ if gt $memUsage 80 }}danger{{ else if gt $memUsage 60 }}warning{{ end }}" style="width: {{ $memUsage }}%;"></div>
                          </div>
                          <span class="resource-value">{{ $memUsage }}%</span>
                          <div class="temp-value">{{ .Int "host_resources.mem_used_mb" }} / {{ .Int "host_resources.mem_total_mb" }} MB</div>
                        </td>
                        <td>
                          {{ $diskUsage := (.Int "host_resources.hdd_usage_percent") }}
                          <div class="resource-bar">
                            <div class="resource-fill disk {{ if gt $diskUsage 80 }}danger{{ else if gt $diskUsage 60 }}warning{{ end }}" style="width: {{ $diskUsage }}%;"></div>
                          </div>
                          <span class="resource-value">{{ $diskUsage }}%</span>
                          <div class="temp-value">{{ .Int "host_resources.hdd_used_gb" }} / {{ .Int "host_resources.hdd_total_gb" }} GB</div>
                        </td>
                        <td>
                          {{ if ne (.String "host_resources.gpu_string") "" }}
                            {{ $gpuUsage := (.Int "host_resources.gpu_gpu_util") }}
                            <div class="resource-bar">
                              <div class="resource-fill gpu {{ if gt $gpuUsage 80 }}danger{{ else if gt $gpuUsage 60 }}warning{{ end }}" style="width: {{ $gpuUsage }}%;"></div>
                            </div>
                            <span class="resource-value">{{ $gpuUsage }}%</span>
                            <div class="temp-value">{{ .String "host_resources.gpu_string" }}</div>
                            <div class="temp-value">{{ .Int "host_resources.gpu_gpu_temp" }}°C • {{ printf "%.1f" (.Float "host_resources.gpu_mem_usage_percent") }}%</div>
                          {{ else }}
                            <span style="color: #666;">No GPU</span>
                          {{ end }}
                        </td>
                        <td>
                          <div class="temp-value">
                            ↓ {{ .Int "host_resources.net_recv_kbsec" }} KB/s<br>
                            ↑ {{ .Int "host_resources.net_send_kbsec" }} KB/s
                          </div>
                        </td>
                        <td>
                          <div class="hardware-info" title="{{ .String "host_resources.hw_info" }}">{{ .String "host_resources.hw_info" }}</div>
                        </td>
                      {{ else }}
                        <td colspan="6" style="text-align: center; color: #666;">No resource data available</td>
                      {{ end }}
                    </tr>
                    {{ end }}
                  </tbody>
                </table>
              </div>

  # Add more pages here:
  # - name: Your page name
  #   columns:
  #     - size: small
  #       widgets:
  #         # Add widgets here

  #     - size: full
  #       widgets:
  #         # Add widgets here

  #     - size: small
  #       widgets:
  #         # Add widgets here